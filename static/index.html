<!DOCTYPE html>
<html>
<head>
    <title>Brief Bridge - Remote Command Execution Bridge</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            margin: 40px; 
            line-height: 1.6; 
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px;
        }
        .header { 
            border-bottom: 2px solid #e1e4e8; 
            padding-bottom: 20px; 
            margin-bottom: 30px; 
        }
        .section { margin: 30px 0; }
        .endpoint { 
            background: #f6f8fa; 
            padding: 15px; 
            border-radius: 6px; 
            margin: 10px 0; 
        }
        .method { font-weight: bold; color: #0969da; }
        .url { 
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace; 
            background: #f6f8fa; 
            padding: 2px 4px; 
            border-radius: 3px; 
        }
        .code { 
            background: #f6f8fa; 
            padding: 15px; 
            border-radius: 6px; 
            overflow-x: auto; 
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-size: 14px;
            line-height: 1.4;
        }
        .ai-section { 
            background: #fff8e1; 
            padding: 20px; 
            border-radius: 8px; 
            border-left: 4px solid #ff9800; 
            margin: 20px 0;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .card {
            background: #fff;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            padding: 20px;
        }
        h1 { color: #24292f; }
        h2 { 
            color: #24292f; 
            border-bottom: 1px solid #e1e4e8; 
            padding-bottom: 5px; 
        }
        h3 { color: #656d76; }
        .status { color: #28a745; font-weight: bold; }
        .warning { color: #d73a49; font-weight: bold; }
        .nav {
            background: #f6f8fa;
            padding: 10px 20px;
            border-radius: 6px;
            margin: 20px 0;
        }
        .nav a {
            margin-right: 20px;
            text-decoration: none;
            color: #0969da;
            font-weight: 500;
        }
        .nav a:hover {
            text-decoration: underline;
        }
    </style>
    <script>
        // Get base URL dynamically
        const baseUrl = window.location.origin;
        
        // Update all placeholder URLs when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Update base URL displays
            document.querySelectorAll('.dynamic-url').forEach(el => {
                el.textContent = baseUrl;
            });
            
            // Update code examples
            document.querySelectorAll('.code').forEach(el => {
                el.innerHTML = el.innerHTML.replace(/\{\{BASE_URL\}\}/g, baseUrl);
            });
        });
    </script>
</head>
<body>
    <div class="header">
        <h1>üåâ Brief Bridge</h1>
        <p>A lightweight tool that bridges AI coding assistants with distributed clients through HTTP polling</p>
        <p class="status">‚úÖ Server Status: Active | Base URL: <span class="url dynamic-url">{{BASE_URL}}</span></p>
    </div>

    <div class="nav">
        <a href="/">API Guide</a>
        <a href="/docs">Swagger Docs</a>
        <a href="/health">Health Check</a>
        <a href="/clients/">List Clients</a>
        <a href="/commands/">List Commands</a>
    </div>

    <div class="ai-section">
        <h2>ü§ñ For AI Assistants</h2>
        <p><strong>This system allows you to execute commands on remote clients via HTTP API.</strong></p>
        
        <div style="background: #ffe0e0; padding: 10px; border-radius: 4px; margin: 10px 0; border-left: 4px solid #d73a49;">
            <strong>‚ö†Ô∏è Important:</strong> AI assistants should use <code>localhost</code> URLs for all API calls. 
            Only remote clients need tunnel URLs for installation.
        </div>
        
        <h3>Architecture Design:</h3>
        <div style="background: #f0f8ff; padding: 15px; border-radius: 6px; margin: 10px 0;">
            <strong>AI (localhost) ‚Üî Brief Bridge (localhost) ‚Üî Tunnel ‚Üî Remote Clients</strong><br>
            ‚Ä¢ AI: Always use localhost URLs<br>
            ‚Ä¢ Clients: Use tunnel URLs for upload/download
        </div>

        <h3>Three Main Workflows:</h3>
        
        <div class="grid" style="grid-template-columns: 1fr; gap: 15px; margin: 20px 0;">
            <div style="background: #f9f9f9; padding: 15px; border-radius: 6px; border-left: 4px solid #28a745;">
                <h4>üöÄ 1. Simple Command Workflow</h4>
                <p><strong>Use for:</strong> Screenshots, system info, small logs</p>
                <ol style="font-size: 14px;">
                    <li>AI sends simple command via POST /commands/submit</li>
                    <li>Client executes and uploads result file</li>
                    <li>Client reports "FILE_UPLOADED: {file_id}" in output</li>
                    <li>AI extracts file_id and downloads via GET /files/download/{file_id}</li>
                    <li>AI analyzes file and cleans up with DELETE /files/{file_id}</li>
                </ol>
            </div>
            
            <div style="background: #f9f9f9; padding: 15px; border-radius: 6px; border-left: 4px solid #007bff;">
                <h4>‚ö° 2. Complex Script Workflow</h4>
                <p><strong>Use for:</strong> System diagnostics, multi-step operations, large reports</p>
                <ol style="font-size: 14px;">
                    <li>AI uploads complex script via POST /files/upload</li>
                    <li>AI gets script_id from upload response</li>
                    <li>AI sends download-and-execute command</li>
                    <li>Client downloads script using tunnel URL</li>
                    <li>Client executes script and uploads result files</li>
                    <li>Client reports "RESULT_UPLOADED: {file_id}" in output</li>
                    <li>AI downloads results and cleans up both script and result files</li>
                </ol>
            </div>
            
            <div style="background: #f9f9f9; padding: 15px; border-radius: 6px; border-left: 4px solid #ffc107;">
                <h4>üîÑ 3. Batch Processing Workflow</h4>
                <p><strong>Use for:</strong> Multi-machine log analysis, batch screenshots</p>
                <ol style="font-size: 14px;">
                    <li>AI uploads processing script once</li>
                    <li>AI sends multiple execution commands referencing same script</li>
                    <li>Multiple clients download and execute same script</li>
                    <li>AI collects and analyzes multiple result files</li>
                    <li>AI cleans up script and result files when done</li>
                </ol>
            </div>
        </div>

        <h3>Quick Start Commands:</h3>
        <div class="code">
# 1. Setup ngrok tunnel
curl -X POST {{BASE_URL}}/tunnel/setup -H "Content-Type: application/json" -d '{"provider": "ngrok"}'

# 2. List registered clients
curl {{BASE_URL}}/clients/

# 3. Submit a command to a client
curl -X POST {{BASE_URL}}/commands/submit \
  -H "Content-Type: application/json" \
  -d '{"target_client_id": "your-client-id", "command_content": "Get-Date", "command_type": "shell"}'

# 4. Check command results
curl {{BASE_URL}}/commands/
        </div>
    </div>

    <div class="grid">
        <div class="card">
            <h3>üîó Tunnel Management</h3>
            <div class="endpoint">
                <span class="method">POST</span> <span class="url">/tunnel/setup</span><br>
                Setup ngrok tunnel - Required: {"provider": "ngrok"}
            </div>
            <div class="endpoint">
                <span class="method">GET</span> <span class="url">/tunnel/status</span><br>
                Get current tunnel status and public URL
            </div>
        </div>

        <div class="card">
            <h3>üë• Client Management</h3>
            <div class="endpoint">
                <span class="method">POST</span> <span class="url">/clients/register</span><br>
                Register new client - Required: {"client_id": "string", "name": "optional"}
            </div>
            <div class="endpoint">
                <span class="method">GET</span> <span class="url">/clients/</span><br>
                List all registered clients
            </div>
            <div class="endpoint">
                <span class="method">GET</span> <span class="url">/clients/{client_id}</span><br>
                Get specific client details
            </div>
        </div>

        <div class="card">
            <h3>‚ö° Command Execution</h3>
            <div class="endpoint">
                <span class="method">POST</span> <span class="url">/commands/submit</span><br>
                Submit command to client
            </div>
            <div class="endpoint">
                <span class="method">POST</span> <span class="url">/commands/poll</span><br>
                Client polls for pending commands
            </div>
            <div class="endpoint">
                <span class="method">POST</span> <span class="url">/commands/result</span><br>
                Client submits execution result
            </div>
            <div class="endpoint">
                <span class="method">GET</span> <span class="url">/commands/</span><br>
                List all commands with results
            </div>
        </div>

        <div class="card">
            <h3>üì¶ Client Installation</h3>
            <div class="endpoint">
                <span class="method">GET</span> <span class="url">/install.ps1</span><br>
                PowerShell one-click install script
            </div>
            <div class="endpoint">
                <span class="method">GET</span> <span class="url">/install.sh</span><br>
                Bash one-click install script (placeholder)
            </div>
        </div>

        <div class="card">
            <h3>üìÅ File Management</h3>
            <div class="endpoint">
                <span class="method">POST</span> <span class="url">/files/upload</span><br>
                Upload files from clients to server
            </div>
            <div class="endpoint">
                <span class="method">GET</span> <span class="url">/files/download/{file_id}</span><br>
                Download files by ID
            </div>
            <div class="endpoint">
                <span class="method">GET</span> <span class="url">/files/</span><br>
                List all uploaded files
            </div>
            <div class="endpoint">
                <span class="method">DELETE</span> <span class="url">/files/{file_id}</span><br>
                Delete files by ID
            </div>
        </div>
    </div>

    <div class="section">
        <h2>üí° Example Usage Scenarios</h2>
        
        <div class="grid">
            <div class="card">
                <h3>System Information Collection</h3>
                <div class="code">
curl -X POST {{BASE_URL}}/commands/submit \
  -H "Content-Type: application/json" \
  -d '{"target_client_id": "your-client", "command_content": "Get-ComputerInfo | Select-Object WindowsProductName, TotalPhysicalMemory", "command_type": "shell"}'
                </div>
            </div>

            <div class="card">
                <h3>File Operations</h3>
                <div class="code">
curl -X POST {{BASE_URL}}/commands/submit \
  -H "Content-Type: application/json" \
  -d '{"target_client_id": "your-client", "command_content": "Get-ChildItem C:\\ -Force | Select-Object Name, Length, LastWriteTime", "command_type": "shell"}'
                </div>
            </div>

            <div class="card">
                <h3>Process Management</h3>
                <div class="code">
curl -X POST {{BASE_URL}}/commands/submit \
  -H "Content-Type: application/json" \
  -d '{"target_client_id": "your-client", "command_content": "Get-Process | Sort-Object CPU -Descending | Select-Object -First 10", "command_type": "shell"}'
                </div>
            </div>

            <div class="card">
                <h3>üì∏ File Transfer Workflow</h3>
                <div class="code">
# 1. Client takes screenshot and uploads
# PowerShell script executed on remote client uploads file

# 2. AI retrieves file list
curl {{BASE_URL}}/files/

# 3. AI downloads specific file
curl {{BASE_URL}}/files/download/{file_id} > screenshot.png

# 4. AI analyzes file and cleans up
curl -X DELETE {{BASE_URL}}/files/{file_id}
                </div>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>‚ö†Ô∏è Important Notes</h2>
        <ul>
            <li><span class="warning">Security:</span> Only use with trusted clients and networks</li>
            <li><span class="warning">PowerShell:</span> Use Write-Output instead of Write-Host for captured output</li>
            <li><span class="warning">Timeouts:</span> Commands have a 30-second execution timeout</li>
            <li><span class="warning">Polling:</span> Clients poll every 5 seconds for new commands</li>
        </ul>
    </div>
</body>
</html>